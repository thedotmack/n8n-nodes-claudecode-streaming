{
  "nodes": [
    {
      "parameters": {
        "trigger": [
          "message"
        ],
        "channelId": {
          "__rl": true,
          "value": "C09ANU1Q0QZ",
          "mode": "list",
          "cachedResultName": "tom-docs"
        },
        "options": {
          "resolveIds": true,
          "userIds": [
            "U09A8P90WJZ",
            "U099X4RDR8X",
            "USLACKBOT",
            "U099YKRV92P"
          ]
        }
      },
      "id": "c588f14c-a052-4425-8497-98362a273fa2",
      "name": "On Message Received",
      "type": "n8n-nodes-base.slackTrigger",
      "position": [
        -1040,
        80
      ],
      "webhookId": "8ff651f2-5030-47a5-a8d6-ed44a0fc89f6",
      "typeVersion": 1,
      "credentials": {
        "slackApi": {
          "id": "Gz8fbHHn1c1YObO6",
          "name": "Slack account"
        }
      }
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "no-subtype-filter",
              "leftValue": "={{ $json.type }}",
              "rightValue": "message",
              "operator": {
                "type": "string",
                "operation": "equals"
              }
            },
            {
              "id": "683877a8-a9ac-49a4-8711-da0a68fbf691",
              "leftValue": "={{ $json.subtype }}",
              "rightValue": "",
              "operator": {
                "type": "string",
                "operation": "notExists",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -816,
        80
      ],
      "id": "42a69e27-b4ca-4290-aed0-990abf3416b9",
      "name": "Filter Noise"
    },
    {
      "parameters": {
        "resource": "reaction",
        "channelId": {
          "__rl": true,
          "value": "C09ANU1Q0QZ",
          "mode": "list",
          "cachedResultName": "tom-docs"
        },
        "timestamp": "={{ $json.ts }}",
        "name": "eyes"
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        -592,
        -16
      ],
      "id": "0154daca-6bd9-4efd-8b8f-2409a642edff",
      "name": "Add Reaction",
      "webhookId": "22a8cd41-11da-44d2-9def-df860d21db94",
      "credentials": {
        "slackApi": {
          "id": "Gz8fbHHn1c1YObO6",
          "name": "Slack account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "// Simple Message Processing - no complex thread management needed\n// SDK handles conversation persistence automatically\nconst items = $input.all();\nconst results = [];\n\nfor (const item of items) {\n  const originalMessage = $('On Message Received').item.json;\n  const messageText = originalMessage.text || '';\n  \n  // Simple processing - just pass the message to Claude Code\n  results.push({\n    json: {\n      action: 'normal_processing',\n      prompt: messageText,\n      channel: 'C09ANU1Q0QZ',\n      event_ts: originalMessage.event_ts || originalMessage.ts,\n      messageText: messageText,\n      timestamp: new Date().toISOString()\n    }\n  });\n}\n\nreturn results;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -592,
        176
      ],
      "id": "bbbf1c66-5114-4925-aefd-1ed1cf807512",
      "name": "Simple Message Processor",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "prompt": "={{ $json.prompt }}",
        "maxTurns": 86400,
        "timeout": 86400,
        "projectPath": "/home/node/docs-empire-markets",
        "allowedTools": [
          "WebFetch",
          "TodoWrite",
          "WebSearch",
          "exit_plan_mode",
          "Task",
          "Read",
          "MultiEdit",
          "LS",
          "Grep",
          "Glob",
          "Edit",
          "Write",
          "Bash"
        ],
        "streamingOptions": {
          "enableStreaming": true,
          "includeTimestamps": true,
          "webhookUrl": "https://n8n.empire.markets/webhook/claude-streaming"
        },
        "additionalOptions": {}
      },
      "type": "@thedotmack/n8n-nodes-claudecode-streaming.claudeCodeStreaming",
      "typeVersion": 1,
      "position": [
        -368,
        176
      ],
      "id": "3aa03f98-f1a0-4d8a-87f8-dfaed7e62d9c",
      "name": "Claude Code Streaming",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "jsCode": "// Simplified Streaming Processor - load from external file\n// This code is loaded from simplified-streaming-processor.js\neval(require('fs').readFileSync('/home/node/n8n-nodes-claudecode-streaming/src/workflows/simplified-streaming-processor.js', 'utf8'));"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -144,
        80
      ],
      "id": "54635fab-d76b-4520-bb5a-3cefac23c33c",
      "name": "Simplified Streaming Processor",
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C09ANU1Q0QZ",
          "mode": "list",
          "cachedResultName": "tom-docs"
        },
        "messageType": "block",
        "blocksUi": "={{ $json.blocks }}",
        "text": "={{ $json.text }}",
        "otherOptions": {
          "includeLinkToWorkflow": false,
          "thread_ts": {
            "replyValues": {
              "thread_ts": "={{ $json.thread_ts }}"
            }
          }
        }
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        80,
        80
      ],
      "id": "c5839899-3f32-49ef-af22-c3df82043e20",
      "name": "Streaming Slack Update",
      "webhookId": "d8b63ae3-153c-419c-98b8-500720165615",
      "credentials": {
        "slackApi": {
          "id": "Gz8fbHHn1c1YObO6",
          "name": "Slack account"
        }
      },
      "onError": "continueRegularOutput"
    },
    {
      "parameters": {
        "select": "channel",
        "channelId": {
          "__rl": true,
          "value": "C09ANU1Q0QZ",
          "mode": "list",
          "cachedResultName": "tom-docs"
        },
        "text": "={{ $json.result || $json.error }}",
        "otherOptions": {
          "includeLinkToWorkflow": false,
          "thread_ts": {
            "replyValues": {
              "thread_ts": "={{ $json.event_ts }}",
              "reply_broadcast": true
            }
          },
          "mrkdwn": true
        }
      },
      "type": "n8n-nodes-base.slack",
      "typeVersion": 2.3,
      "position": [
        -144,
        272
      ],
      "id": "6d2ea711-9254-4041-869d-9842d8887135",
      "name": "Send Final Response",
      "webhookId": "1f6a1300-9eed-42af-b30f-9a5901a3d887",
      "credentials": {
        "slackApi": {
          "id": "Gz8fbHHn1c1YObO6",
          "name": "Slack account"
        }
      },
      "onError": "continueRegularOutput"
    }
  ],
  "connections": {
    "On Message Received": {
      "main": [
        [
          {
            "node": "Filter Noise",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter Noise": {
      "main": [
        [
          {
            "node": "Simple Message Processor",
            "type": "main",
            "index": 0
          },
          {
            "node": "Add Reaction",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simple Message Processor": {
      "main": [
        [
          {
            "node": "Claude Code Streaming",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Claude Code Streaming": {
      "main": [
        [
          {
            "node": "Send Final Response",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Simplified Streaming Processor",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Simplified Streaming Processor": {
      "main": [
        [
          {
            "node": "Streaming Slack Update",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "instanceId": "a05210b476fa640672a7c86424ec8108aff686f288b0dd16da68e95e1ed40ce5"
  }
}